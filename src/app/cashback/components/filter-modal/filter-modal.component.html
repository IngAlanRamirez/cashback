@if (isOpen) {
  <ion-modal 
    [isOpen]="isOpen" 
    (willDismiss)="closeModal()" 
    class="filter-modal"
    [breakpoints]="[0, modalBreakpoint(), maxBreakpoint()]"
    [initialBreakpoint]="modalBreakpoint()"
    [backdropDismiss]="true">
    <ng-template>
      <ion-header class="modal-header">
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="closeModal()" class="cancel-btn">
              Cancelar
            </ion-button>
          </ion-buttons>
          <ion-title>Filtrar</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <div class="filter-content">
          <div class="filter-section">
            <h3 class="filter-section-title">Periodo</h3>
            <div class="filter-chips">
              @for (period of periods; track period.value) {
                <div 
                  class="filter-chip" 
                  [class.selected]="selectedPeriod() === period.value"
                  (click)="selectPeriod(period.value)"
                  role="button"
                  tabindex="0">
                  {{ period.label }}
                </div>
              }
            </div>
          </div>

          <div class="filter-section">
            <h3 class="filter-section-title">Establecimiento</h3>
            <div class="filter-chips">
              @for (category of categories; track category.value) {
                <div 
                  class="filter-chip" 
                  [class.selected]="selectedCategory() === category.value"
                  (click)="selectCategory(category.value)"
                  role="button"
                  tabindex="0">
                  @if (category.icon) {
                    <ion-icon [name]="category.icon"></ion-icon>
                  }
                  {{ category.label }}
                </div>
              }
            </div>
          </div>

          <div class="filter-actions">
            <button 
              class="apply-filters-btn" 
              (click)="applyFilters()"
              type="button">
              Aplicar filtros
            </button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
}
